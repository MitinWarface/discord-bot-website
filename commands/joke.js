const { SlashCommandBuilder, EmbedBuilder } = require('discord.js');
const axios = require('axios');

module.exports = {
    data: new SlashCommandBuilder()
        .setName('joke')
        .setDescription('–†–∞—Å—Å–∫–∞–∑–∞—Ç—å —Å–ª—É—á–∞–π–Ω—É—é —à—É—Ç–∫—É'),

    async execute(interaction) {
        try {
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≥—Ä—É–∑–∫–µ
            await interaction.reply({ content: 'üòÑ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ö–æ—Ä–æ—à–µ–π —à—É—Ç–∫–∏...', ephemeral: true });
            
            // –ü–æ–ª—É—á–∞–µ–º —à—É—Ç–∫—É —Å Jokes API
            const response = await axios.get('https://v2.jokeapi.dev/joke/Any?type=single', {
                headers: {
                    'Accept': 'application/json'
                }
            });
            
            if (response.data && response.data.joke) {
                const joke = response.data.joke;
                
                const jokeEmbed = new EmbedBuilder()
                    .setTitle('üòÑ –°–ª—É—á–∞–π–Ω–∞—è —à—É—Ç–∫–∞')
                    .setDescription(joke)
                    .setColor('#FFD700')
                    .setFooter({ 
                        text: 'JokeAPI.dev', 
                        iconURL: 'https://cdn.discordapp.com/emojis/852823024249856000.png' 
                    })
                    .setTimestamp();
                
                // –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –Ω–∞ —à—É—Ç–∫—É
                await interaction.editReply({ content: null, embeds: [jokeEmbed] });
            } else {
                // –ï—Å–ª–∏ –æ—Å–Ω–æ–≤–Ω–æ–π API –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—ã–π –Ω–∞–±–æ—Ä —à—É—Ç–æ–∫
                const backupJokes = [
                    "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –≤—Å–µ–≥–¥–∞ –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ Oct 31 = Dec 25!",
                    "–ñ–µ–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞: - –°—Ö–æ–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω, –∫—É–ø–∏ –±–∞—Ç–æ–Ω –∫–æ–ª–±–∞—Å—ã. –ï—Å–ª–∏ –±—É–¥—É—Ç —è–π—Ü–∞, –≤–æ–∑—å–º–∏ –¥–µ—Å—è—Ç–æ–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç 10 –±–∞—Ç–æ–Ω–æ–≤ –∫–æ–ª–±–∞—Å—ã.",
                    "–ï—Å–ª–∏ –±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –±—ã–ª–∏ –≤—Ä–∞—á–∞–º–∏, –æ–Ω–∏ –±—ã –≥–æ–≤–æ—Ä–∏–ª–∏: '–•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å - –≤–∞—à–∞ –±–æ–ª–µ–∑–Ω—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤—É. –ü–ª–æ—Ö–∞—è –Ω–æ–≤–æ—Å—Ç—å - –≤—ã–ª–µ—á–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.'",
                    "–ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø–æ—à–µ–ª —É—Å—Ç—Ä–∞–∏–≤–∞—Ç—å—Å—è –Ω–∞ —Ä–∞–±–æ—Ç—É. HR: '–ï—Å—Ç—å –ª–∏ —É –≤–∞—Å –æ–ø—ã—Ç —Ä–∞–±–æ—Ç—ã?' –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç: '–î–∞, –Ω–æ –æ–Ω –Ω–µ—É–¥–∞—á–Ω—ã–π.'",
                    "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –Ω–µ —Ö–æ–¥—è—Ç –≤ –ª–µ—Å? –ë–æ—é—Ç—Å—è –≤—Å—Ç—Ä–µ—Ç–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª!",
                    "–ö–∞–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–æ—Å–∏—Ç –∂–µ–Ω—É: '–î–æ—Ä–æ–≥–∞—è, –ø—Ä–∏–Ω–µ—Å–∏ –º–Ω–µ –±—É—Ç—ã–ª–∫—É –≤–æ–¥—ã.' –ê –æ–Ω–∞: '–¢—ã –∑–∞–±—ã–ª, —á—Ç–æ —è —Ç–µ–±–µ —Å–∫–∞–∑–∞–ª–∞? –Ø —Ç–µ–±–µ –Ω–µ –∂–µ–Ω–∞, —è —Ç–µ–±–µ –Ω–µ –º–∞—Ç—å –∏ —è —Ç–µ–±–µ –Ω–µ —Å–ª—É–∂–∞–Ω–∫–∞!' –û–Ω: '–ê —Ç—ã –Ω–µ –º–æ–≥–ª–∞ –º–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ?'",
                    "–ï—Å–ª–∏ –±—ã –±–æ–≥–∏ —Ö–æ—Ç–µ–ª–∏, —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ –ª–µ—Ç–∞–ª, –æ–Ω–∏ –±—ã –¥–∞–ª–∏ –µ–º—É IP-–∞–¥—Ä–µ—Å.",
                    "–ï—Å–ª–∏ –±—ã –±–æ–≥–∏ —Ö–æ—Ç–µ–ª–∏, —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ –ª–µ—Ç–∞–ª, –æ–Ω–∏ –±—ã –Ω–µ –¥–∞–≤–∞–ª–∏ –µ–º—É –Ω–∏—á–µ–≥–æ. –ü–æ—Ç–æ–º—É —á—Ç–æ –≤—Å–µ —Ä–∞–≤–Ω–æ –Ω–µ –≤–∑–ª–µ—Ç–µ–ª –±—ã.",
                    "–ï—Å–ª–∏ –±—ã –±–æ–≥–∏ —Ö–æ—Ç–µ–ª–∏, —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ –ª–µ—Ç–∞–ª, –æ–Ω–∏ –±—ã –¥–∞–ª–∏ –µ–º—É –∫—Ä—ã–ª—å—è. –ù–æ —Ä–∞–∑ –Ω–µ –¥–∞–ª–∏, –∑–Ω–∞—á–∏—Ç –Ω–µ —Ö–æ—Ç–µ–ª–æ—Å—å.",
                    "–ï—Å–ª–∏ –±—ã –±–æ–≥–∏ —Ö–æ—Ç–µ–ª–∏, —á—Ç–æ–±—ã —á–µ–ª–æ–≤–µ–∫ –ª–µ—Ç–∞–ª, –æ–Ω–∏ –±—ã –¥–∞–ª–∏ –µ–º—É —Å–∞–º–æ–ª–µ—Ç."
                ];
                
                const randomJoke = backupJokes[Math.floor(Math.random() * backupJokes.length)];
                
                const jokeEmbed = new EmbedBuilder()
                    .setTitle('üòÑ –†–µ–∑–µ—Ä–≤–Ω–∞—è —à—É—Ç–∫–∞')
                    .setDescription(randomJoke)
                    .setColor('#FFD700')
                    .setFooter({ 
                        text: '–†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫', 
                        iconURL: 'https://cdn.discordapp.com/emojis/852823024249856000.png' 
                    })
                    .setTimestamp();
                
                await interaction.editReply({ content: null, embeds: [jokeEmbed] });
            }
        } catch (error) {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —à—É—Ç–∫–∏:', error);
            
            // –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–µ–∑–µ—Ä–≤–Ω—É—é —à—É—Ç–∫—É
            const fallbackJokes = [
                "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –≤—Å–µ–≥–¥–∞ –ø—É—Ç–∞—é—Ç –•—ç–ª–ª–æ—É–∏–Ω –∏ –†–æ–∂–¥–µ—Å—Ç–≤–æ? –ü–æ—Ç–æ–º—É —á—Ç–æ Oct 31 = Dec 25!",
                "–ñ–µ–Ω–∞ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç–∞: - –°—Ö–æ–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω, –∫—É–ø–∏ –±–∞—Ç–æ–Ω –∫–æ–ª–±–∞—Å—ã. –ï—Å–ª–∏ –±—É–¥—É—Ç —è–π—Ü–∞, –≤–æ–∑—å–º–∏ –¥–µ—Å—è—Ç–æ–∫. –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç –ø—Ä–∏–Ω–æ—Å–∏—Ç 10 –±–∞—Ç–æ–Ω–æ–≤ –∫–æ–ª–±–∞—Å—ã.",
                "–ï—Å–ª–∏ –±—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –±—ã–ª–∏ –≤—Ä–∞—á–∞–º–∏, –æ–Ω–∏ –±—ã –≥–æ–≤–æ—Ä–∏–ª–∏: '–•–æ—Ä–æ—à–∞—è –Ω–æ–≤–æ—Å—Ç—å - –≤–∞—à–∞ –±–æ–ª–µ–∑–Ω—å –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–æ –Ω–∞—Å–ª–µ–¥—Å—Ç–≤—É. –ü–ª–æ—Ö–∞—è –Ω–æ–≤–æ—Å—Ç—å - –≤—ã–ª–µ—á–∏—Ç—å –º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.'"
            ];
            
            const randomFallbackJoke = fallbackJokes[Math.floor(Math.random() * fallbackJokes.length)];
            
            const fallbackEmbed = new EmbedBuilder()
                .setTitle('üòÑ –†–µ–∑–µ—Ä–≤–Ω–∞—è —à—É—Ç–∫–∞')
                .setDescription(randomFallbackJoke)
                .setColor('#FFD700')
                .setFooter({ 
                    text: '–†–µ–∑–µ—Ä–≤–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫', 
                    iconURL: 'https://cdn.discordapp.com/emojis/852823024249856000.png' 
                })
                .setTimestamp();
            
            await interaction.editReply({ content: null, embeds: [fallbackEmbed] });
        }
    }
};